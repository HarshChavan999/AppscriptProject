    <script>
    
 // Global variable for debouncing Aadhaar input
    let aadhaarLookupTimeoutId;

    // --- Main Inquiry Form Submission Handler (Remains unchanged - focus on Aadhaar lookup for this issue) ---
    function InquiryFormHandle(e) {
        e.preventDefault();

        const agreeCheckbox = document.getElementById("agree1");
        if (!agreeCheckbox?.checked) {
            document.getElementById("agreeError1").textContent = "Please agree to the terms";
            return;
        } else {
            document.getElementById("agreeError1").textContent = "";
        }

        const submitBtn = document.getElementById("submitButton2");
        const originalBtnContent = submitBtn.innerHTML;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Processing...';
        submitBtn.disabled = true;

        const formValues = {
            date: document.getElementById("date")?.value || new Date().toISOString().split("T")[0],
            fullName: document.getElementById("fullName")?.value.trim() || "",
            aadhaar: document.getElementById("aadhaar")?.value.trim() || "",
            qualification: document.getElementById("qualification")?.value.trim() || "",
            phoneNo: document.getElementById("phoneNo")?.value.trim() || "",
            whatsappNo: document.getElementById("whatsappNo")?.value.trim() || "",
            parentsNo: document.getElementById("parentsNo")?.value.trim() || "",
            email: document.getElementById("email")?.value.trim() || "",
            age: document.getElementById("age")?.value.trim() || "",
            address: document.getElementById("address")?.value.trim() || "",
            interestedCourse: document.getElementById("interestedCourse")?.value.trim() || "",
            inquiryTakenBy: document.getElementById("inquiryTakenBy")?.value.trim() || "",
            branch: document.getElementById("branch22")?.value.trim() || "",
            loggedInUserId: document.getElementById("loggedInUserId")?.value.trim() || "Anonymous"
        };

        console.log("DEBUG: InquiryProcessForm - Form Values sent to server:", formValues);

        google.script.run
            .withSuccessHandler((response) => {
                console.log("DEBUG: InquiryProcessForm - Server Response (Success):", response);
                if (response.success) {
                    Swal.fire({
                        icon: "success",
                        title: "Success!",
                        text: response.message,
                        confirmButtonColor: "#1e3a8a",
                    }).then(() => {
                        document.getElementById("ifId")?.reset();
                        const aadhaarStatus = document.getElementById('aadhaarStatus');
                        if (aadhaarStatus) {
                            aadhaarStatus.textContent = '';
                            aadhaarStatus.className = 'aadhaar-status';
                        }
                    });
                } else {
                    Swal.fire({
                        icon: "error",
                        title: "Validation Error",
                        text: response.message,
                        confirmButtonColor: "#1e3a8a",
                    });
                }
                submitBtn.innerHTML = originalBtnContent;
                submitBtn.disabled = false;
            })
            .withFailureHandler((error) => {
                console.error("DEBUG: InquiryProcessForm - Script Error (Failure):", error);
                Swal.fire({
                    icon: "error",
                    title: "Script Error",
                    text: error.message || "An unexpected error occurred.",
                    confirmButtonColor: "#1e3a8a",
                });
                submitBtn.innerHTML = originalBtnContent;
                submitBtn.disabled = false;
            })
            .InquiryProcessForm(formValues);
    }

    // --- DOMContentLoaded: Executes when the HTML document is fully loaded ---
    document.addEventListener('DOMContentLoaded', () => {
        // Get references to form elements
        const aadhaarInput = document.getElementById('aadhaar');
        const aadhaarStatus = document.getElementById('aadhaarStatus');
        const fullNameInput = document.getElementById('fullName');
        const qualificationInput = document.getElementById('qualification');
        const ageInput = document.getElementById('age');
        const phoneNoInput = document.getElementById('phoneNo');
        const whatsappNoInput = document.getElementById('whatsappNo');
        const parentsNoInput = document.getElementById('parentsNo');
        const emailInput = document.getElementById('email');
        const addressInput = document.getElementById('address');
        const dateInput = document.getElementById('date');

        // Initialize 'date' field with today's date if it exists and is empty
        if (dateInput && !dateInput.value) {
            const today = new Date();
            const year = today.getFullYear();
            const month = (today.getMonth() + 1).toString().padStart(2, '0');
            const day = today.getDate().toString().padStart(2, '0');
            dateInput.value = `${year}-${month}-${day}`;
        }

        // --- Aadhaar Lookup Logic: Only if the Aadhaar input field exists ---
        if (aadhaarInput && aadhaarStatus) {
            aadhaarInput.addEventListener('input', () => {
                clearTimeout(aadhaarLookupTimeoutId);

                const aadhaarNumber = aadhaarInput.value.trim();
                console.log(`DEBUG: Aadhaar input changed. Value: "${aadhaarNumber}"`);

                aadhaarStatus.textContent = '';
                aadhaarStatus.className = 'aadhaar-status';

                if (aadhaarNumber.length === 12 && /^\d{12}$/.test(aadhaarNumber)) {
                    aadhaarStatus.textContent = 'Checking...';
                    aadhaarStatus.classList.add('status-checking');
                    console.log('DEBUG: Aadhaar valid (12 digits), setting up lookup debounce.');

                    aadhaarLookupTimeoutId = setTimeout(() => {
                        console.log(`DEBUG: Debounce finished. Calling lookupAadhaarRecord for "${aadhaarNumber}".`);
                        google.script.run
                            .withSuccessHandler(data => {
                                console.log('DEBUG: lookupAadhaarRecord - Success handler triggered.');
                                console.log('DEBUG: lookupAadhaarRecord - Data received:', data);

                                aadhaarStatus.textContent = '';
                                aadhaarStatus.className = 'aadhaar-status';

                                if (data.found) {
                                    console.log('DEBUG: Aadhaar found. Prompting user.');
                                    Swal.fire({
                                        title: 'Aadhaar Found!',
                                        text: `Record for "${data.record.fullName}" found. Do you want to pre-fill the form with this existing data?`,
                                        icon: 'question',
                                        showCancelButton: true,
                                        confirmButtonText: 'Yes, pre-fill it!',
                                        cancelButtonText: 'No, I\'ll enter new data',
                                        confirmButtonColor: '#1e3a8a',
                                        cancelButtonColor: '#d33'
                                    }).then((result) => {
                                        console.log('DEBUG: SweetAlert2 prompt result:', result);
                                        if (result.isConfirmed) {
                                            aadhaarStatus.textContent = 'Pre-filling form with existing data.';
                                            aadhaarStatus.classList.add('status-found');
                                            console.log('DEBUG: User confirmed pre-fill. Attempting to populate fields.');

                                            if (fullNameInput) fullNameInput.value = data.record.fullName || '';
                                            if (qualificationInput) qualificationInput.value = data.record.qualification || '';
                                            if (ageInput) ageInput.value = data.record.age || '';
                                            if (phoneNoInput) phoneNoInput.value = data.record.phoneNo || '';
                                            if (whatsappNoInput) whatsappNoInput.value = data.record.whatsappNo || '';
                                            if (parentsNoInput) parentsNoInput.value = data.record.parentsNo || '';
                                            if (emailInput) emailInput.value = data.record.email || '';
                                            if (addressInput) addressInput.value = data.record.address || '';

                                            if (data.record.date && dateInput) {
                                                const recordDate = new Date(data.record.date);
                                                if (!isNaN(recordDate.getTime())) {
                                                    const year = recordDate.getFullYear();
                                                    const month = (recordDate.getMonth() + 1).toString().padStart(2, '0');
                                                    const day = recordDate.getDate().toString().padStart(2, '0');
                                                    dateInput.value = `${year}-${month}-${day}`;
                                                } else {
                                                    console.warn("DEBUG: Invalid date format received for pre-fill:", data.record.date);
                                                }
                                            }
                                        } else if (result.isDismissed) {
                                            console.log('DEBUG: User dismissed pre-fill. Keeping current form data.');
                                            aadhaarStatus.textContent = 'Aadhaar found. Continue with new data.';
                                            aadhaarStatus.classList.add('status-new');
                                        }
                                    });
                                } else {
                                    console.log('DEBUG: Aadhaar NOT found. Treating as new entry.');
                                    aadhaarStatus.textContent = 'New Aadhaar. Please fill the form.';
                                    aadhaarStatus.classList.add('status-new');

                                    // Clear fields for a new Aadhaar entry
                                    if (fullNameInput) fullNameInput.value = '';
                                    if (qualificationInput) qualificationInput.value = '';
                                    if (ageInput) ageInput.value = '';
                                    if (phoneNoInput) phoneNoInput.value = '';
                                    if (whatsappNoInput) whatsappNoInput.value = '';
                                    if (parentsNoInput) parentsNoInput.value = '';
                                    if (emailInput) emailInput.value = '';
                                    if (addressInput) addressInput.value = '';
                                }
                            })
                            .withFailureHandler(err => {
                                console.error('DEBUG: lookupAadhaarRecord - Failure handler triggered. Error:', err);
                                aadhaarStatus.textContent = '';
                                aadhaarStatus.className = 'aadhaar-status';

                                aadhaarStatus.textContent = 'Error checking Aadhaar. Please try again.';
                                aadhaarStatus.classList.add('status-error');

                                if (fullNameInput) fullNameInput.value = '';
                                if (qualificationInput) qualificationInput.value = '';
                                if (ageInput) ageInput.value = '';
                                if (phoneNoInput) phoneNoInput.value = '';
                                if (whatsappNoInput) whatsappNoInput.value = '';
                                if (parentsNoInput) parentsNoInput.value = '';
                                if (emailInput) emailInput.value = '';
                                if (addressInput) addressInput.value = '';
                            })
                            .lookupAadhaarRecord(aadhaarNumber);
                    }, 700);
                } else {
                    console.log('DEBUG: Aadhaar invalid (not 12 digits or not numeric). Clearing fields.');
                    aadhaarStatus.textContent = 'Enter a 12-digit Aadhaar Number.';
                    aadhaarStatus.classList.add('status-error');
                    
                    if (fullNameInput) fullNameInput.value = '';
                    if (qualificationInput) qualificationInput.value = '';
                    if (ageInput) ageInput.value = '';
                    if (phoneNoInput) phoneNoInput.value = '';
                    if (whatsappNoInput) whatsappNoInput.value = '';
                    if (parentsNoInput) parentsNoInput.value = '';
                    if (emailInput) emailInput.value = '';
                    if (addressInput) addressInput.value = '';
                }
            });
        } else {
            console.warn("DEBUG: Aadhaar input field (id='aadhaar') or status element (id='aadhaarStatus') not found. Aadhaar lookup will not function.");
        }

        // --- Your other custom JavaScript functions (add them here as needed) ---
        window.onPhoneBlur = function() { /* ... */ };
        window.updateCourseDetails = function() { /* ... */ };
        window.openAdmissionForm = function() { /* ... */ };
        window.copyInquiry = function() { /* ... */ };
    });

    




    </script>